<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Бесконечный платформер с кнопкой</title>
<style>
  html, body {
    margin: 0; 
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #87ceeb; /* голубое небо */
    overflow: hidden;
    flex-direction: column;
  }
  #game {
    background: #cceedd;
    display: block;
    /* Задаём фиксированный размер или подгоняем под экран */
    width: 480px;
    height: 320px;
    max-width: 100vw;
    max-height: 80vh;
    border: 2px solid #333;
  }
  #jumpButton {
    margin-top: 15px;
    width: 120px;
    height: 50px;
    font-size: 24px;
    border-radius: 10px;
    background-color: #4CAF50;
    color: white;
    border: none;
    user-select: none;
    touch-action: manipulation;
  }
  #jumpButton:active {
    background-color: #388E3C;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="jumpButton">Прыжок</button>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

canvas.width = 480;
canvas.height = 320;

const gravity = 0.6;

class Player {
  constructor() {
    this.width = 30;
    this.height = 50;
    this.x = 50;
    this.y = canvas.height - this.height - 100;
    this.dy = 0;
    this.jumpForce = -12;
    this.grounded = false;
  }
  
  update() {
    this.dy += gravity;
    this.y += this.dy;
    
    if(this.y + this.height > canvas.height) {
      this.y = canvas.height - this.height;
      this.dy = 0;
      this.grounded = true;
    } else {
      this.grounded = false;
    }
  }
  
  jump() {
    if(this.grounded) {
      this.dy = this.jumpForce;
      this.grounded = false;
    }
  }
  
  draw() {
    ctx.fillStyle = 'red';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Platform {
  constructor(x, y, width=100, height=15) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
  }
  
  update(speed) {
    this.x -= speed;
  }
  
  draw() {
    ctx.fillStyle = 'green';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

const player = new Player();
let platforms = [];
let platformSpeed = 3;
let frameCount = 0;

// Стартовая платформа
platforms.push(new Platform(0, canvas.height - 30, canvas.width, 30));

function collision(player, platform) {
  return player.x < platform.x + platform.width &&
         player.x + player.width > platform.x &&
         player.y + player.height > platform.y &&
         player.y + player.height < platform.y + platform.height + player.dy;
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  frameCount++;

  if(frameCount % 120 === 0) {
    let platformHeight = canvas.height - 30 - Math.random() * 100;
    platforms.push(new Platform(canvas.width, platformHeight));
  }

  for(let i = platforms.length -1; i >= 0; i--) {
    platforms[i].update(platformSpeed);
    platforms[i].draw();

    if(platforms[i].x + platforms[i].width < 0) {
      platforms.splice(i, 1);
    }
  }

  platforms.forEach(platform => {
    if(collision(player, platform)) {
      player.y = platform.y - player.height;
      player.dy = 0;
      player.grounded = true;
    }
  });

  player.update();
  player.draw();

  requestAnimationFrame(gameLoop);
}

window.addEventListener('keydown', (e) => {
  if(e.code === 'Space') {
    player.jump();
  }
});

// Кнопка прыжка для тачскринов
const jumpButton = document.getElementById('jumpButton');
jumpButton.addEventListener('touchstart', (e) => {
  e.preventDefault(); // чтобы не было задержки и скролла
  player.jump();
});
jumpButton.addEventListener('mousedown', (e) => {
  e.preventDefault();
  player.jump();
});

gameLoop();
</script>
</body>
</html>
