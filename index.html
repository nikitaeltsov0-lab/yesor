<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pac-Man Phonk Mobile</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 100vh; background: #000; font-family: Arial, sans-serif; color: #fff; 
            overflow: hidden; touch-action: none; 
        }
        #score { font-size: 20px; margin: 10px; font-weight: bold; text-shadow: 0 0 5px #ff00de; }
        #gameCanvas { 
            border: 3px solid #00f; background: #000; 
            max-width: 100vw; max-height: 55vh; touch-action: none; 
            box-shadow: 0 0 20px rgba(0, 0, 255, 0.5);
        }
        #controls { 
            display: grid; grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 70px); 
            gap: 10px; margin: 15px; 
        }
        .btn { 
            background: linear-gradient(145deg, #1e3a8a, #3b82f6); 
            border: 2px solid #60a5fa;
            border-radius: 15px; color: white; font-size: 32px; 
            cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); 
            touch-action: manipulation; 
        }
        .btn:active { 
            background: linear-gradient(145deg, #3b82f6, #1e3a8a); transform: scale(0.95); 
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.8);
        }
        #up { grid-column: 2; grid-row: 1; }
        #left { grid-column: 1; grid-row: 2; }
        #down { grid-column: 2; grid-row: 3; }
        #right { grid-column: 3; grid-row: 2; }
        
        #restart { 
            grid-column: 2; grid-row: 2; 
            background: linear-gradient(145deg, #7c2d12, #ea580c); 
            border-color: #fb923c;
            font-size: 20px; 
        }
        #restart:active { background: linear-gradient(145deg, #ea580c, #7c2d12); }

        /* –ö–Ω–æ–ø–∫–∞ –º—É–∑—ã–∫–∏ */
        #musicBtn {
            grid-column: 3; grid-row: 1;
            background: linear-gradient(145deg, #4c1d95, #8b5cf6);
            border-color: #a78bfa;
            font-size: 24px;
        }
        #musicBtn:active { background: linear-gradient(145deg, #8b5cf6, #4c1d95); }

        .game-over { color: #ff0; font-size: 24px; margin: 10px; display: none; text-shadow: 2px 2px #f00; }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="music.mp3" type="audio/mp3">
        <source src="music.ogg" type="audio/ogg">
    </audio>

    <div id="score">SCORE: 0</div>
    <canvas id="gameCanvas" width="420" height="420"></canvas>
    <div id="gameOver" class="game-over">WASTED!</div>

    <div id="controls">
        <button class="btn" id="musicBtn">üîá</button> <button class="btn" id="up">‚¨ÜÔ∏è</button>
        <button class="btn" id="left">‚¨ÖÔ∏è</button>
        <button class="btn" id="restart">üîÑ</button>
        <button class="btn" id="right">‚û°Ô∏è</button>
        <button class="btn" id="down">‚¨áÔ∏è</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const cellSize = 20;
        const rows = 21;
        const cols = 21;
        let score = 0;
        let gameOver = false;

        // –ú—É–∑—ã–∫–∞
        const musicBtn = document.getElementById('musicBtn');
        const bgMusic = document.getElementById('bgMusic');
        let isMusicPlaying = false;

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicBtn.textContent = 'üîá';
                musicBtn.style.opacity = "0.7";
            } else {
                bgMusic.volume = 0.5; // –ì—Ä–æ–º–∫–æ—Å—Ç—å 50%
                bgMusic.play().then(() => {
                    musicBtn.textContent = 'üéµ';
                    musicBtn.style.opacity = "1";
                }).catch(e => console.log("–ù—É–∂–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"));
            }
            isMusicPlaying = !isMusicPlaying;
        }

        musicBtn.addEventListener('click', (e) => {
            e.preventDefault();
            toggleMusic();
        });
        musicBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            toggleMusic();
        });


        // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ª–∞–±–∏—Ä–∏–Ω—Ç
        const maze = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1],
            [1,3,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,3,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],
            [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
            [1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1],
            [1,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1],
            [1,1,1,1,1,0,1,0,1,1,2,1,1,0,1,0,1,1,1,1,1],
            [2,0,0,0,0,0,0,0,1,2,2,2,1,0,0,0,0,0,0,0,2],
            [1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1],
            [1,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1],
            [1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1],
            [1,3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3,1],
            [1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1],
            [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
            [1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        const pacman = { x: 10, y: 15, dir: 0, nextDir: 0, mouthOpen: true };
        const ghosts = [
            {x: 9, y: 9, color: '#ff0000', dir: 0},
            {x: 11, y: 9, color: '#ffb8ff', dir: 2},
            {x: 9, y: 11, color: '#00ffff', dir: 3},
            {x: 11, y: 11, color: '#ffb852', dir: 1}
        ];
        const directions = [
            {dx: 1, dy: 0}, {dx: 0, dy: 1}, {dx: -1, dy: 0}, {dx: 0, dy: -1}
        ];

        function drawMaze() {
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ–æ–Ω–∞ –¥–ª—è Phonk —Å—Ç–∏–ª—è
            ctx.shadowBlur = 0;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = maze[row][col];
                    const x = col * cellSize;
                    const y = row * cellSize;
                    
                    if (cell === 1) {
                        ctx.fillStyle = '#0a0a2a'; // –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω —Å—Ç–µ–Ω
                        ctx.fillRect(x, y, cellSize, cellSize);
                        ctx.strokeStyle = '#00f'; // –ù–µ–æ–Ω–æ–≤–∞—è –æ–±–≤–æ–¥–∫–∞
                        ctx.lineWidth = 1;
                        ctx.strokeRect(x, y, cellSize, cellSize);
                    } else if (cell === 0) {
                        ctx.fillStyle = '#ffff99';
                        ctx.beginPath();
                        ctx.arc(x + cellSize/2, y + cellSize/2, 2, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (cell === 3) {
                        ctx.fillStyle = '#fff';
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = "#fff";
                        ctx.beginPath();
                        ctx.arc(x + cellSize/2, y + cellSize/2, 5, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.shadowBlur = 0;
                    }
                }
            }
        }

        function drawPacman() {
            const x = pacman.x * cellSize + cellSize/2;
            const y = pacman.y * cellSize + cellSize/2;
            const radius = cellSize/2 - 2;
            
            ctx.fillStyle = '#ffff00';
            ctx.shadowBlur = 10;
            ctx.shadowColor = "#ffff00"; // –°–≤–µ—á–µ–Ω–∏–µ –ø–∞–∫–º–∞–Ω–∞
            ctx.beginPath();
            const angle = pacman.mouthOpen ? 0.25 : 0.1;
            const startAngle = (pacman.dir * Math.PI/2) + angle * Math.PI;
            const endAngle = (pacman.dir * Math.PI/2) - angle * Math.PI;
            ctx.arc(x, y, radius, startAngle, endAngle);
            ctx.lineTo(x, y);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        function drawGhosts() {
            ghosts.forEach(ghost => {
                const x = ghost.x * cellSize;
                const y = ghost.y * cellSize;
                
                ctx.shadowBlur = 8;
                ctx.shadowColor = ghost.color; // –°–≤–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑—Ä–∞–∫–æ–≤
                ctx.fillStyle = ghost.color;
                ctx.beginPath();
                ctx.arc(x + cellSize/2, y + cellSize/4, cellSize/2, Math.PI, 0, false);
                ctx.rect(x, y + cellSize/4, cellSize, cellSize * 3/4);
                ctx.fill();
                
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x + cellSize/3, y + cellSize/3, 3, 0, Math.PI * 2);
                ctx.arc(x + cellSize*2/3, y + cellSize/3, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(x + cellSize/3, y + cellSize/3, 2, 0, Math.PI * 2);
                ctx.arc(x + cellSize*2/3, y + cellSize/3, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function canMove(x, y) {
            if (x < 0 || x >= cols || y < 0 || y >= rows) return true;
            return maze[y][x] !== 1;
        }

        function movePacman() {
            const nextX = pacman.x + directions[pacman.nextDir].dx;
            const nextY = pacman.y + directions[pacman.nextDir].dy;

            if (canMove(nextX, nextY)) {
                pacman.dir = pacman.nextDir;
            }

            const newX = pacman.x + directions[pacman.dir].dx;
            const newY = pacman.y + directions[pacman.dir].dy;

            if (canMove(newX, newY)) {
                pacman.x = newX;
                pacman.y = newY;
                
                if (pacman.x < 0) pacman.x = cols - 1;
                if (pacman.x >= cols) pacman.x = 0;

                if (maze[pacman.y][pacman.x] === 0) {
                    maze[pacman.y][pacman.x] = 2;
                    score += 10;
                } else if (maze[pacman.y][pacman.x] === 3) {
                    maze[pacman.y][pacman.x] = 2;
                    score += 50;
                }
                document.getElementById('score').textContent = 'SCORE: ' + score;
            }
            pacman.mouthOpen = !pacman.mouthOpen;
        }

        function moveGhosts() {
            ghosts.forEach(ghost => {
                if (Math.random() < 0.3) {
                    ghost.dir = Math.floor(Math.random() * 4);
                }
                const newX = ghost.x + directions[ghost.dir].dx;
                const newY = ghost.y + directions[ghost.dir].dy;
                
                if (canMove(newX, newY)) {
                    ghost.x = newX;
                    ghost.y = newY;
                    if (ghost.x < 0) ghost.x = cols - 1;
                    if (ghost.x >= cols) ghost.x = 0;
                }
            });
        }

        function checkCollision() {
            for (let ghost of ghosts) {
                if (pacman.x === ghost.x && pacman.y === ghost.y) {
                    gameOver = true;
                    document.getElementById('gameOver').style.display = 'block';
                    bgMusic.pause(); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º—É–∑—ã–∫—É –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
                }
            }
        }

        function gameLoop() {
            if (gameOver) return;
            
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawMaze();
            drawPacman();
            drawGhosts();
            
            movePacman();
            moveGhosts();
            checkCollision();
            
            setTimeout(gameLoop, 200);
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.getElementById('up').addEventListener('touchstart', (e) => { e.preventDefault(); pacman.nextDir = 3; });
        document.getElementById('down').addEventListener('touchstart', (e) => { e.preventDefault(); pacman.nextDir = 1; });
        document.getElementById('left').addEventListener('touchstart', (e) => { e.preventDefault(); pacman.nextDir = 2; });
        document.getElementById('right').addEventListener('touchstart', (e) => { e.preventDefault(); pacman.nextDir = 0; });
        document.getElementById('restart').addEventListener('touchstart', (e) => { e.preventDefault(); location.reload(); });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') pacman.nextDir = 0;
            if (e.key === 'ArrowDown') pacman.nextDir = 1;
            if (e.key === 'ArrowLeft') pacman.nextDir = 2;
            if (e.key === 'ArrowUp') pacman.nextDir = 3;
        });

        gameLoop();
    </script>
</body>
</html>
