<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Бесконечный платформер</title>
<style>
  body {
    margin: 0; 
    overflow: hidden;
    background: #87ceeb; /* голубое небо */
  }
  canvas {
    display: block;
    background: #cceedd;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

canvas.width = 480;
canvas.height = 320;

const gravity = 0.6;

class Player {
  constructor() {
    this.width = 30;
    this.height = 50;
    this.x = 50;
    this.y = canvas.height - this.height - 100;
    this.dy = 0;
    this.jumpForce = -12;
    this.grounded = false;
  }
  
  update() {
    this.dy += gravity;
    this.y += this.dy;
    
    if(this.y + this.height > canvas.height) {
      this.y = canvas.height - this.height;
      this.dy = 0;
      this.grounded = true;
    } else {
      this.grounded = false;
    }
  }
  
  jump() {
    if(this.grounded) {
      this.dy = this.jumpForce;
      this.grounded = false;
    }
  }
  
  draw() {
    ctx.fillStyle = 'red';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Platform {
  constructor(x, y, width=100, height=15) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
  }
  
  update(speed) {
    this.x -= speed;
  }
  
  draw() {
    ctx.fillStyle = 'green';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

const player = new Player();
let platforms = [];
let platformSpeed = 3;
let frameCount = 0;

// Создаём стартовую платформу
platforms.push(new Platform(0, canvas.height - 30, canvas.width, 30));

function collision(player, platform) {
  return player.x < platform.x + platform.width &&
         player.x + player.width > platform.x &&
         player.y + player.height > platform.y &&
         player.y + player.height < platform.y + platform.height + player.dy;
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  frameCount++;

  // Добавляем платформы каждые 120 кадров (~4 секунды)
  if(frameCount % 120 === 0) {
    let platformHeight = canvas.height - 30 - Math.random() * 100;
    platforms.push(new Platform(canvas.width, platformHeight));
  }

  // Обновляем и рисуем платформы
  for(let i = platforms.length -1; i >= 0; i--) {
    platforms[i].update(platformSpeed);
    platforms[i].draw();

    // Удаляем платформы, которые вышли за экран слева
    if(platforms[i].x + platforms[i].width < 0) {
      platforms.splice(i, 1);
    }
  }

  // Обработка столкновения игрока с платформами
  platforms.forEach(platform => {
    if(collision(player, platform)) {
      player.y = platform.y - player.height;
      player.dy = 0;
      player.grounded = true;
    }
  });

  player.update();
  player.draw();

  requestAnimationFrame(gameLoop);
}

// Прыжок по пробелу
window.addEventListener('keydown', (e) => {
  if(e.code === 'Space') {
    player.jump();
  }
});

gameLoop();
</script>
</body>
</html>
